## 1. 未来可玩性优化（未完成）
### 变量服务配合剧情系统
- 现在变量同步和订阅已经统一，可以尝试做“变量驱动剧情”：比如新增一个“分支故事”扩展，监听 variables_updated，根据变量值切换角色台词、触发不同世界书条目或自动插入系统提示，让玩家看到变量变化带来的剧情差异。
### 统一 API SDK 带来的跨扩展交互
- 既然 SillyTavern.extensions 已经封装了消息、虚拟化、世界书、角色、UI 等模块，可尝试做一个“扩展中控台”：集中展示哪些扩展在运行、快速切换角色/预设、批量操作消息等。也可以做“扩展联动”：例如把世界书检索、提示词模板、聊天面板的定制组合成一个单点交互。
### 虚拟化/渲染管线与 UI 创意
- 虚拟化已处理好性能，可以加一些可视化插件，比如“消息互动气泡”“时间线模式”“角色关系图”等，只要在 st-message-* 事件里插入额外 DOM，并利用 renderPipeline.registerStage 在 after-render 阶段补充 UI，就不会拖慢整体渲染。
### Worker 管道用于实时反馈
- 既然 Worker 管理器已打通，可以尝试做“实时分析”扩展：将用户输入/AI 输出丢到 Worker 做情绪分析、关键词提取，再把结果以彩色标签、旁注展示在消息上。这样既提升玩法，也证明 Worker 优化的价值。
### 后端队列与扩展任务
- 内存队列 queues:extensions 已拓展，可以做“后台任务”类功能：比如异步下载/整理角色卡资源、根据历史聊天生成总结、自动同步世界书到某个远端。任务进度通过我们新增的事件/metrics 再回显到前端。
### 开放变量调试 UI 给玩家
- 借助 __variableDebug__，可以编写一个前端扩展展示当前 chat/global/message 变量状态，允许玩家手动编辑变量来解锁隐藏剧情或启动彩蛋。对有自定义需求的玩家很有吸引力。
### 跨聊天宇宙联动
- 利用统一变量与世界书接口，开发“平行世界”扩展，根据不同 chat/global 变量自动合并或切换世界书条目，实现角色穿越、记忆共享等玩法。
提前计算，别等模型写完再驳回

#### 把“模型出叙述→发现变量不符→要求重写”改成“模型说：打什么招式→系统先判定→再让模型写结果”。
也就是先截获判定请求（战斗动作、技能施放等），交给 Worker/脚本算出结果，再把结果回填进模型提示。这么做只多一个判定步骤，延迟通常是几百毫秒，远小于让模型二次输出。
2. Worker 通用协议
- 不强求每个角色卡自带脚本，先定义统一的“判定任务”格式：{ action, actor, target, stateSnapshot }。
- Worker 接收到任务后依据角色配置/扩展逻辑选择合适的计算器（可以由酒馆助手、角色扩展注册），返回 { outcome, updatedState }。
- 如果某角色没有特定脚本，可配置兜底逻辑（比如随机骰子 + 世界书规则）。这样既不会污染故事流程，又让计算可以扩展。

3. 缓存与并发
- 常用的、纯读操作（例如获取某个角色属性）可以直接命中缓存，不走 Worker。
- 真正耗时的判定才发 Worker，计算完成后再把 updatedState 写回 variableService 并推给模型。
- Worker 可以起多个实例或用 Web Worker 池减少排队。

4. 模型输入结构
- 在提示里提前告诉模型：“系统已判断：Boss 还剩 30 血，你的攻击未命中，请描述失败”。
- 模型只负责叙述，不决定变量，有效避免“谄媚式胜利”。

5. 降低时间开销
- 判定逻辑尽量在本地（前端 Web Worker 或后端脚本）执行，避免远程请求。
- 支持异步判定；如果模型请求了多个动作，可并行触发多个 Worker。
- 同时允许“快速模式”：当用户不开启复杂判定时，仍走旧流程以保证流畅体验。